# 11月5日——函数 

## 一、函数

```c
返回值类型 函数名(参数声明表) {
    声明和语句
}
```

例如：

```c
char foo(char b) {
    return b;
}
int main() {
    char a;
    a = 'A';
    printf('%c', foo(a));
    return 0;
}
```

`foo`函数定义中的形式参数为`b`，而在`main`函数中调用`foo`时所传入的实际参数是`a`。而它们的值其实都会是`'A'`。 `b`的作用域就是`foo`函数的定义范围。如果我们在`main`中使用`b`则需要另外定义一个作用域在`main`内的变量`b`。不同作用域内，哪怕变量名相同，也需要分别在对应的作用域内声明变量和使用。



## 二、递归

在其他情况下，返回一个包含本身函数的递归调用的这种递归设计，被我们称为 头递归（head recursion）。

```c
int factorial(int n) {
    if (n == 1) {
        return 1;
    }
    return factorial(n - 1) * n;
}
```



与头递归相对应，我们还有一个概念叫 尾递归（tail recursion）。

```c
int factorial(int n, int product) {
    if (n == 0) {
        return product;
    }
    product = product * n;
    return factorial(n - 1, product);
}
```

尾递归的实现中，每一次函数的递归调用都会将一个阶段性的结果传递到下一个被调用的函数中，当最终的一般条件（如这里的n == 0）满足时，把最终结果直接返回。



## 三、声明与实现分离

函数的声明（declaration of function）。它描述了函数中的参数、返回类型等信息。在声明中，函数参数的名称也可以省略。

```c
#include <stdio.h>
#include <math.h>
double f(double, double);
double h(int );

int main() {
    double x;
    double y;
    double z;
    x = f(1, 0.5);
    y = f(2, 0.25);
    z = h(x);
    printf("%g\n%g\n%g\n", x, y, z);
    return 0;
}

double f(double a, double b) {
    return sqrt((a - cos(b)) / 2);
}
double h(int x) {
    return 2 * x + f(3, 0.15);
}
```



## 四、函数命名

函数命名追求“明确”和“清晰”（见名知意）。

在 C 语言的变量和函数命名时，我们有以下几个可以遵循的原则：

1. 尽可能不要用过短的命名，除非这是一个只在几行的作用域内使用的变量。 
2. 除非被大家所普遍接受，且在程序中被频繁使用，否则不要对组成变量名、函数名的单词进行缩略。 
3. 使用下划线_来分隔变量名、函数名中的单词。



## 五、变量地址作为函数参数

关于函数变量作用域的理解：

一个用于交换变量x和 变量y的值的swap函数。在main函数中调用时，swap函数被传入了x和y两个实际参数。

这两个参数被传入到了swap函数定义的形式参数a和b中。

但是，由于swap中的参数a和b的作用域有限，函数内的交换并不会影响到main函数中x和y的值。

> **可以这么认为，函数的形式参数相当于定义了只存在于本函数内部的变量，该变量是实际传入变量的一个拷贝副本，对形式参数的任何修改都只是对副本的修改与操作，不会对实际传入参数的值产生影响。**



事实上，我们可以通过传入主函数中变量的地址，**这个可以通过在传入参数时使用取地址符&实现，但是在定义时是不需要使用的**，通过给函数传递变量在内存中的位置，而函数是不会改变传入参数的，因此地址不会改变，但是地址里的内容可以在函数中进行改变。

> 在函数声明中，我们是通过使用
>
> ```c
> void swap(int *a, int *b);
> ```
>
> 中的`int *a`，表示传入的是整型变量的地址值，对于传入其他类型的变量的地址值的声明也是类似，如`char *c`。



### (一)取值运算符`*`

取值运算符`*`会被用在存储地址的变量之前。

例如，对于一个存储整数型变量的地址的变量p，我们如果希望取出它的值赋值给另一个变量m，我们可以直接写m = \*p；而如果我们希望将p存储的地址对应的内存的值改成3，我们则可以直接写*p = 3。

**一定要注意在函数声明中使用的`*`与在函数当中使用`*`的作用区别：在函数声明中使用`*`表示传入的是某类型数据的地址，这就要求在实际传入时要使用取地址符`&`，而在函数内要使用该地址中的数据就需要使用取值运算符`*`来获取地址内的数据。**



## 六、函数地址作为传入参数

如果一个函数可以被传入另一个函数，当传入的函数不同时，同样的一个被传入函数就可能会产生不同的功能。

C 语言中函数和变量类似，也是有自己的内存地址的。但是，函数不像变量一样可以进行值传递，我们在将其作为函数参数进行传递时，需要传递它的地址。

(**Python面向对象的特点：函数也是对象，因此可以直接传递参数；**

**而C语言是静态类型语言，它无法直接传递函数，因此，它只能传递函数的地址作为变量**)

以下面的代码为例子：

```c
int g(float (*f)(int), int a) {
    return f(a);
}
```

函数g需要有一个形式参数用于接收函数地址。在这个函数定义中，第一个参数需要一个返回值类型为float且有一个int类型参数的函数，第二个参数就是普通的int类型的值。

以函数地址作为传入参数的标准格式：

```c
函数返回值类型 (*函数名)(传入参数的类型)
```

其中，需要在函数名前面加上`*`并使其与函数名共同包装在一个括号内，表示传入的是一个函数的地址，第二个括号里的是该函数的传入参数的类型，这里就不需要指出形式参数的名字了。

**这样一个函数g(或者f)，使用它的函数名的时候，其实是在使用它的地址。**因此，我们在接到形式参数中的函数地址后，我们**可以直接写 f(a)**。**这与我们用取值符取出函数地址并进行函数调用 (*f)(a) 的方式是等价的。**

**不同于传变量地址时需要用取值符的做法**，在调用上面这个g函数，并且将函数地址作为参数时，**直接将函数名传入就可以了。**(**因为在C语言中函数名就是地址**)。

举例如下：

```c
int g(float (*f)(int), int a) {
    return f(a);
}
float sqrt_minus_one(int x) {
    return sqrt(x) - 1;
}
g(sqrt_minus_one, number);
```

