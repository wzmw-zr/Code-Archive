

## 一、文件操作

### (一)文件读取——`fgetc()和fputc()函数`

在**读文件**的时候我们需要先有一个可以让我们访问到文件的 **文件指针（file pointer）**，它是一个**FILE类型的指针**。

通过下面的方式声明一个文件指针：

```c
FILE *fp;
```

这时候，如果我们希望对一个文件进行操作，我们需要先使用：

```c
fp = fopen(文件路径, 访问模式);
```

**将文件指针和文件关联起来**，其中第一个参数是一个字符串，对应了我们希望访问的文件路径。第二个参数是访问模式，它可以是表示只读模式的"r"，也可以是表示只写模式的"w"，还可以是在文件末尾追加的"a"。



当我们**将文件指针和文件关联起来后**，我们就可以**通过`fgetc(fp)`;获得当前指针之后位置的一个字符了，每获得一个字符，指针会向后移动一个字符（如果到达文件尾部则会返回`EOF`）**。 

我们这时**通过`fputc('c', fp);`的方式将字符'c'写入到`fp`关联的文件内**了。



### (二)文件复制

实现将一个文件复制到另一个文件内的函数`filecopy`：

```c
void filecopy(FILE *in_fp, FILE *out_fp) {
    char ch;
    while ((ch = fgetc(in_fp)) != EOF) {
        fputc(ch, out_fp);
    }
}
```

这个函数接收的两个参数都是文件指针。这个函数会**通过一个可读模式的文件指针逐字符地读取**，并且**通过一个可写模式的文件指针逐字符地将所有字符写出**，从而**起到复制文件内容的作用**。

需要注意，在**给文件指针进行命名**的时候，要避开 `stdin`、`stdout `和 `stderr `这三个名称。因为**这三个名称其实已经用于标准输入、标准输出、标准错误的文件指针**。

不过我们看到的 `stdin`、`stdout` 和 `stderr` 的这三个文件指针可以直接使用。

我们是**通过 `fgetc(stdin)`; 获得来自标准输入的字符**，也可以**通过` fputc(ch, stdout); `或 `fputc(ch, stderr); `将变量 ch 中的字符输出到标准输出或标准错误中**的。



### (三)`fscanf`与`fprintf`函数

除了`fgetc`和`fputc`之外，我们还可以使用`fscanf`和`fprintf`函数。这两个函数都很像我们已经很熟悉的`scanf`和`printf`函数，只是不过，`scanf`和`printf `可以被看作` fscanf`和`fprintf `的特例。 我们使用` fscanf `从文件指针`in_fp`进行**读取**时，可以写成：

```c
fscanf(in_fp, "%c", &a);
```

而如果我们写：

```c
fscanf(stdin, "%c", &a);
```

这将完全与下面直接使用`scanf`的方式等价：

```c
scanf("%c", &a);
```

类似地，我们使用`fprintf`向文件指针`out_fp`进行写出时，可以写成：

```c
fprintf(out_fp, "%c", a);
```

而如果我们写：

```c
fprintf(stdout, "%c", a);
```

这将完全与下面直接使用`printf`等价：

```c
printf("%s", a);
```



### (四)取消文件关联

在使用文件并且确定不再继续使用后，我们要通过下面所示的方式将文件指针`fp`与文件的关联断开。你可以将它视为和`fopen`相反的一个操作。

```c
fclose(fp);
```

**如果你不在程序中使用`fclose`，程序正常结束时，程序会为所有打开的文件调用`fclose`。** `stdin、stdout `其实也是可以被打开的文件指针，如果你觉得用不到的话，其实也是可以使用`fclose` 将他们关闭掉的。

